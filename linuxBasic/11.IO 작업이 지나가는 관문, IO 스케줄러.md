# 11.I/O 작업이 지나가는 관문, I/O 스케줄러
I/O 작업은 가상파일 시스템, 로컬 파일 시스템등 경로를 거친 후 블록 디바이스로 전달되기 전에 I/O 스케줄러를 거치게 된다.

### I/O 스케줄러의 필요성
#### 디스크 종류
- HDD  
    - 데이터를 읽을때 디스크 헤드를 플래터의 특정 위치로 움직이게 해야한다. 
    - 기계 장치라 이동시간이 소요되므로 헤드의 움직임을 최소화 하고 한번 움직일때 ㅚ대한 처리애햐 I/O성능이 극대화 된다.
- SSD
    - 전기적 신호를 이용해 접근하기 때문에 임의로 특정 섹터에 접근 할 때 소요되는 시간이 모두 동일하다.
#### I/O 스케줄러의 성능 극대화 작업
 커널은 I/O 스케줄러를 통해서 조금이라도 성능을 극대화 하려하고 이런 작업을 위해서 병합과 정렬 두가지 방법을 사용한다.
 - 병합 
    - 여러개의 요청을 하나로 합치는 것
    - RequestQueue 에 총 3개의 요청(각 10번 블록에서 1개 , 11번에서 1개, 12번에서 1개의 블록내용을 읽어오는 요청)이 있다면,  
        접근 블록이 인접해 있기 때문에 이 세개의 요청을 하나의 큰 요청으로 합쳐서 넘겨준다.
 - 정렬    
    - 여거래의 요청을 섹터 순서대로 재배치 하여 최적의 경로를 이용하도록 하는 것
    - 먼저 발생한 요청이 더 늦게 처리되는 문제가 있다.
    - SSD의 경우 헤드 이동 비용이 없으므로 정렬이 별 의미 없음

### I/O 스케줄러 설정
- 각각의 I/O 스케줄러별로 튜닝 가능한 파라미터들이 다르다.
- `echo cfq > ./scheduler` : cfq I/O 스케줄러 변경하기
#### I/O 스케줄러 종류
- cfq(Completely Fair Queueing) I/O 스케줄러
    - 요청을 특성에 따라 RT(Real Time), BE(Best Effort), IDLE 중 하나로 분류하고 RT에 속한 요청들을 가장 먼저 처리하고 IDLE에 속한 요청들을 가장 나중에 처리한다.
    - RT, BE IDLE 로 분류한 다음에는 service tree라 불리는 워크로드별 그룹으로 다시 나눈다.
        - SYNC : 순차적인 동기화 I/O 작업으로, 큐에 대한 처리를 완료한 후 일정 시간동안 대기한다.   
                순차 작업이기 때에 향후에 들어오는 I/O 요청도 현재 디스크의 헤드와 가까운 위치의 작업이 들어올문 확률이 높아서이다.  
                 `slice-idle` 값으로 이 대기시간을 설정한다.
        - SYNC_NOIDLE : 임의적인 동기화 I/O 작업, 주로 임의 읽기를 의미한다.   
                        각 큐에 대한 처리 완료 후 대기 없이 바로 다음 큐 작업 시작
        - ASYNC : 비동기화 I/O 작업, 주로 쓰기 작업을 의미한다.  
                  동기화 I/O 작업들은 프로세스별로 큐를 가지고 있지만, 비동기 I/O작업은 ASYNC 서비스 트리밑에 하나로 모아놓고 한꺼번에 처리한다.
- 각 성질에 맞게 나뉜 I/O 요청들을 cfq queue에 넣고 각각 ㅈ동등한 타임슬라이스를 할당한 다 음 이 값을 기준으로 큐들을 순차적으로 처리한다.
- 모든 프로세스들에 치우침 없이 동등한 I/O 요청 처리 기회를 주지만, 일부 프로세스들에 대해 성능이 낮아질 수 있다.

     